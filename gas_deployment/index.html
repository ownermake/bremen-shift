<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bremen シフト管理</title>
    <style>
        <? !=include('stylesheet');
        ?>
    </style>
</head>

<body>
    <div id="toast-container"></div>

    <!-- Login View -->
    <div id="login-view" class="view active">
        <div class="login-container">
            <h1>Bremen Shift</h1>

            <div class="login-tabs">
                <button class="login-tab-btn active" data-tab="staff">スタッフ</button>
                <button class="login-tab-btn" data-tab="admin">管理者</button>
            </div>

            <!-- Staff Login -->
            <div id="staff-login-form" class="login-form active">
                <div class="form-group">
                    <label>スタッフ名を選択</label>
                    <select id="login-staff-select" class="form-select">
                        <option value="">選択してください</option>
                        <!-- JS populated -->
                    </select>
                </div>
                <button id="staff-login-btn" class="btn-primary full-width" disabled>ログイン</button>
            </div>

            <!-- Admin Login -->
            <div id="admin-login-form" class="login-form">
                <div class="form-group">
                    <label>パスワード</label>
                    <input type="password" id="admin-password" class="form-input" placeholder="パスワードを入力">
                </div>
                <button id="admin-login-btn" class="btn-primary full-width">管理者としてログイン</button>
            </div>
        </div>
    </div>

    <!-- Header (shared) -->
    <header class="header" style="display: none;">
        <div class="header-logo">Bremen</div>
        <nav class="header-nav">
            <button class="nav-btn active" data-view="home">ホーム</button>
            <button class="nav-btn" data-view="calendar">カレンダー</button>
            <button class="nav-btn" data-view="summary">サマリー</button>
            <button class="nav-btn" data-view="admin" style="display: none;">設定</button>
        </nav>
    </header>

    <!-- Home View -->
    <div id="home-view" class="view main-content">
        <div class="view-header">
            <div class="view-title">本日の出勤</div>
            <div class="view-date" id="today-date">2026/01/23 (金)</div>
        </div>
        <div id="today-staff-list" class="staff-list">
            <!-- JS populated -->
        </div>
    </div>

    <!-- Calendar View -->
    <div id="calendar-view" class="view main-content">
        <div class="calendar-controls">
            <button id="prev-month" class="icon-btn">&lt;</button>
            <span id="current-month" class="calendar-month-label">2026年 1月</span>
            <button id="next-month" class="icon-btn">&gt;</button>
        </div>
        <div class="calendar-header">
            <div>日</div>
            <div>月</div>
            <div>火</div>
            <div>水</div>
            <div>木</div>
            <div>金</div>
            <div>土</div>
        </div>
        <div id="calendar-grid" class="calendar-grid">
            <!-- JS populated -->
        </div>
    </div>

    <!-- Day Detail View -->
    <div id="day-detail-view" class="view main-content">
        <div class="view-header">
            <button class="back-btn" onclick="switchView('calendar')">←</button>
            <div class="view-title" id="detail-date">1月23日 (金)</div>
            <button id="add-staff-btn" class="action-btn">＋追加</button>
        </div>
        <div id="day-staff-list" class="staff-list">
            <!-- JS populated -->
        </div>
    </div>

    <!-- Edit Shift View -->
    <div id="edit-view" class="view main-content">
        <div class="view-header">
            <button class="back-btn" onclick="switchView('calendar')">← カレンダー</button>
            <div class="view-title">シフト編集</div>
        </div>

        <div class="edit-form">
            <div class="form-group">
                <label>スタッフ</label>
                <div id="staff-selector" class="staff-selector">
                    <!-- JS populated -->
                </div>
                <input type="hidden" id="edit-staff">
            </div>

            <div class="form-group">
                <label>日付</label>
                <input type="date" id="edit-date" class="form-input">
            </div>

            <div class="form-group">
                <label>時間</label>
                <div class="time-range-shortcuts" id="time-presets">
                    <!-- Presets -->
                </div>
                <div class="time-inputs">
                    <select id="edit-in-time" class="form-select time-select"></select>
                    <span>〜</span>
                    <select id="edit-out-time" class="form-select time-select"></select>
                </div>
            </div>

            <div class="form-group">
                <label>備考</label>
                <div class="chip-group">
                    <button class="chip-btn active" data-val="">なし</button>
                    <button class="chip-btn" data-val="早上がり">早上がり</button>
                    <button class="chip-btn" data-val="遅入り">遅入り</button>
                    <button class="chip-btn" data-val="台湾出張">台湾出張</button>
                    <button class="chip-btn" data-val="休暇">休暇</button>
                    <button class="chip-btn" data-val="半休">半休</button>
                </div>
                <input type="text" id="edit-note" class="form-input" placeholder="その他備考">
            </div>

            <div class="form-actions">
                <button id="delete-shift-btn" class="btn-danger" style="display:none;"
                    onclick="deleteShift()">削除</button>
                <button id="save-shift-btn" class="btn-primary" onclick="saveShift()">保存</button>
            </div>
        </div>
    </div>

    <!-- Summary View -->
    <div id="summary-view" class="view main-content">
        <div class="calendar-controls">
            <button id="summary-prev-month" class="icon-btn">&lt;</button>
            <span id="summary-month" class="calendar-month-label">2026年 1月</span>
            <button id="summary-next-month" class="icon-btn">&gt;</button>
        </div>
        <div id="summary-container" class="summary-list">
            <!-- JS populated -->
        </div>
    </div>

    <!-- Admin View -->
    <div id="admin-view" class="view main-content">
        <div class="view-header">
            <div class="view-title">設定・管理</div>
        </div>

        <div class="data-manage-container">
            <div class="data-stats">
                <div class="stat-item">
                    <span class="stat-label">スタッフ数</span>
                    <span class="stat-value" id="user-count">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">シフト総数</span>
                    <span class="stat-value" id="shift-count">-</span>
                </div>
                <!-- total-cost-item added by JS -->
            </div>
            <div class="data-actions">
                <button id="reset-shifts-btn" class="delete-btn full-width">全データ削除 (リセット)</button>
            </div>
        </div>

        <!-- Sync Section -->
        <div class="sync-container">
            <div class="sync-header">
                <h3>クラウド同期設定</h3>
                <div id="sync-status" class="sync-status"></div>
            </div>

            <div class="form-group">
                <label>GAS Web App URL (配布用)</label>
                <input type="text" id="gas-url" class="form-input" placeholder="https://script.google.com/..."
                    style="font-size: 12px;">
                <p class="sync-help-text">※このアプリ自体のURLを入力してください</p>
            </div>

            <div class="sync-actions">
                <button id="sync-upload-btn" class="btn-secondary small">⬆ クラウドへ保存</button>
                <button id="sync-download-btn" class="btn-secondary small">⬇ クラウドから取得</button>
            </div>
        </div>

        <!-- Preset Management -->
        <div class="admin-section">
            <div class="section-header">
                <h3>時間プリセット設定</h3>
            </div>
            <div class="preset-manage-container">
                <div class="preset-add-group">
                    <select id="new-preset-in" class="form-select micro"></select>
                    <span>〜</span>
                    <select id="new-preset-out" class="form-select micro"></select>
                    <button id="add-preset-btn" class="btn-primary small">追加</button>
                </div>
                <div id="admin-preset-list" class="preset-list">
                    <!-- JS populated -->
                </div>
            </div>
        </div>

        <div class="admin-section-header">
            <h3>スタッフ管理</h3>
            <button id="add-staff-btn-admin" class="action-btn small" onclick="openStaffModal(null)">＋追加</button>
        </div>
        <div id="admin-staff-list" class="admin-staff-list">
            <!-- JS populated -->
        </div>
    </div>

    <!-- Modals -->
    <div id="staff-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="staff-modal-title">スタッフ追加</h3>
            <div class="form-group">
                <label>名前</label>
                <input type="text" id="staff-name" class="form-input">
            </div>
            <!-- Hidden ID -->
            <input type="hidden" id="staff-id">

            <div class="form-group">
                <label>時給 (円)</label>
                <input type="number" id="staff-rate" class="form-input" placeholder="例: 1000">
            </div>

            <div class="form-group">
                <label>深夜時給 (22時以降)</label>
                <input type="number" id="staff-night-rate" class="form-input" placeholder="例: 2000 (空欄なら通常時給)">
            </div>

            <div class="form-group checkbox-group">
                <input type="checkbox" id="staff-is-admin" class="form-checkbox">
                <label for="staff-is-admin" class="form-label inline">管理者権限を付与する</label>
            </div>

            <div class="modal-actions">
                <button id="delete-staff-btn" class="delete-btn" style="display:none;">削除</button>
                <div class="action-right">
                    <button id="close-modal-btn" class="btn-secondary">キャンセル</button>
                    <button id="save-staff-btn" class="btn-primary">保存</button>
                </div>
            </div>
        </div>
    </div>

    <script>
      <?!= include('javascript'); ?>
    </script>
</body>

</html>